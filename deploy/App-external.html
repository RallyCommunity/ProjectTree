<!DOCTYPE html>
<html>
<head>
    <title>ProjectTree</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("Rally.ui.tree.extendedTreeItem",{alias:"widget.extendedTreeItem",extend:"Rally.ui.tree.TreeItem",config:{displayedFields:["Name","Description","TeamMembers"]},draw:function(){var me=this;this.content&&this.content.destroy();var cls="treeItemContent";this.getSelectable()&&(cls+=" selectable"),this.expander?this.toggleExpander():this.expander=this.drawExpander(),this.insert(1,{xtype:"container",itemId:"treeItemContent",overflowX:!0,cls:cls,layout:{type:"hbox"},items:[{xtype:"component",renderTpl:this.getContentTpl(),renderData:this.getRenderData(),listeners:{afterrender:function(){this.setupListeners(),this.fireEvent("draw")},scope:this}},{xtype:"container",itemId:"userInfoRecord",layout:{type:"hbox"},style:{marginLeft:"50px"},listeners:{afterrender:function(cmp){var treeItem=me,record=me.getRecord();record.getCollection("TeamMembers").load().then({success:function(data){_.each(data,function(member){cmp.add({xtype:"container",cls:"rally-textfield-component",style:{marginLeft:"10px"},html:member.get("_refObjectName")})})}})}}}]})}}),Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",launch:function(){var app=this,pt=Ext.create("Rally.ui.tree.ProjectTree",{config:{treeItemConfigForRecordFn:function(record){return"workspace"===record.get("_type")?{xtype:"rallyplaintreeitem"}:{xtype:"extendedTreeItem",selectable:!0}},topLevelStoreConfig:{fetch:["Name","Editors","State","Workspace"],filters:[{property:"State",value:"Open"},{property:"Projects.State",value:"Open"}],sorters:[{property:"Name",direction:"ASC"}],context:function(){app._getContext(app)}},childItemsStoreConfigForParentRecordFn:function(record){var storeConfig={fetch:["Name","Description","Children:summary[State]","State","Workspace"],sorters:[{property:"Name",direction:"ASC"}]};return"workspace"===record.get("_type")?Ext.apply(storeConfig,{filters:[{property:"Parent",value:"null"}],context:{workspace:record.get("_ref"),project:null}}):Ext.apply(storeConfig,{filters:[{property:"Parent",value:record.get("_ref")}],context:{workspace:record.get("Workspace")._ref,project:null}})}}});this.add(pt)}});

            Rally.launchApp('CustomApp', {
                name:"ProjectTree",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
